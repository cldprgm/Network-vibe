{% load tz %}
{% load static %}
<hr style='width: 45rem;'>
{% for post in posts %}
    <div class="text-white card custom-card mb-0" style='width: 45rem; border-radius: 18px;'>
        <div class="card-body">
            <h6 class="text-white d-flex align-items-center">
                <!-- Avatar -->
                <img
                  src="{{ post.author.profile.avatar.url }}"
                  class="rounded-circle"
                  alt="{{ profile }}"
                  width="40"
                  height="40"
                >
                
                <!-- Text -->
                <div class="ms-2 d-flex flex-column">
                    <!-- Nickname + time -->
                    <div>
                        <a
                          class="custom-a fw-bold"
                          href="{{ post.author.profile.get_absolute_url }}"
                        >
                            {{ post.author.username }}
                        </a>
                        <span style="color: rgba(255, 255, 255, 0.75);">â€¢ {{ post.created|timesince }} ago</span>
                    </div>
                
                </div>
            </h6>
            
            <a class='custom-a' style='text-decoration: none;' href="{{ post.get_absolute_url }}">
                <h4 class="card-title">
                    {{ post.title }}
                </h4>
                {% for media in post.media.all %}
                    <div class="media-container" style="background: black; position: relative; width: 100%; aspect-ratio: {{ media.get_aspect_ratio }}; border: 1px solid rgba(236, 234, 234, 0.42); border-radius: 16px; overflow: hidden; max-height: 640px;">
                        {% if media.media_type == 'image' %}
                            <!-- Background image -->
                            <img src="{{ media.file.url }}" style="position: absolute; top: 50%; left: 0; width: 150%; transform: translateY(-50%) scale(1.2); opacity: 0.3; object-fit: cover; filter: blur(8px);">
                            <!-- Main image -->
                            <img src="{{ media.file.url }}" style="position: relative; width: 100%; height: 100%; object-fit: contain;">
                        {% elif media.media_type == 'video' %}
                            <!-- Video -->
                            <video controls style="width: 100%; height: 100%; object-fit: contain;">
                                <source src="{{ media.file.url }}" type="video/mp4">
                            </video>
                        {% endif %}
                    </div>
                {% empty %}
                    {% if post.description %}
                        <p class='mb-1' style="color: rgba(255, 255, 255, 0.75);">{{ post.description }}</p>               
                    {% endif %}
                {% endfor %}
                
            </a>
            
        </div>
        <div class="post-toolbar">
            <div class="post-rating-buttons ms-2 mb-1">
                <button class="btn btn-sm btn-secondary rounded-circle border-0" 
                    data-content-type="{{ post_content_type }}" 
                    data-object-id="{{ post.id }}" 
                    data-value="1">
                    <img src="{% static 'icons/upvote.svg' %}" 
                        data-content-type="{{ post_content_type }}" 
                        data-object-id="{{ post.id }}" 
                        data-value="1" 
                        width="16" height="16" 
                        style="filter: invert(1);">
                </button>
                <span class="post-rating-sum">{{ post.rating_sum }}</span>
                <button class="btn btn-sm btn-secondary rounded-circle border-0" 
                    data-content-type="{{ post_content_type }}"
                    data-object-id="{{ post.id }}"
                    data-value="-1">
                    <img src="{% static 'icons/downvote.svg' %}" 
                        data-content-type="{{ post_content_type }}"
                        data-object-id="{{ post.id }}"
                        data-value="-1" 
                        width="16" height="16" 
                        style="filter: invert(1);">
                </button>
            </div>
            <a href="{{ post.get_absolute_url }}" class="toolbar-button ms-2 mb-1">
                <img src="{% static 'icons/comment.svg' %}" width="16" height="16" style="filter: invert(1);">
                <span>{{ post.comments_count }}</span>
            </a>
            <a href="/" class="toolbar-button ms-2 mb-1">              
                <img src="{% static 'icons/share.svg' %}" width="22" height="22" style="filter: invert(1);">
                Share
            </a>
        </div>
    </div>
    <hr style='width: 45rem;'>
    
{% endfor %}
<script src="{% static '/utils.js' %}"></script>
<script src="{% static '/ratings.js' %}"></script>
{% block script %}{% endblock script %}